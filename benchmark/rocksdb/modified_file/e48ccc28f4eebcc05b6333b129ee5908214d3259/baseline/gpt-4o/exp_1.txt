总结：新版函数主要将遍历方式替换为基于范围的循环，并将重复的自定义字段编码逻辑提取为 lambda 函数，从而简化代码结构、减少重复、提高可读性和维护性。