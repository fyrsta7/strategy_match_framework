一句总结：修改后的函数提前判断并返回无效层级，同时提取关键变量，优化了代码的健壮性和可读性。