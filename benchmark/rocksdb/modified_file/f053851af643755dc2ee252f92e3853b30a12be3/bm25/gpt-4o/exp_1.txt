这次修改主要是将计算“祖父”级别的逻辑独立出来，并在级别越界时提前返回，从而提高了代码的可读性和鲁棒性。